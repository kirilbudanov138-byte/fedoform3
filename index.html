<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fedoform ‚Äî –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å</title>
    <script src="https://accounts.google.com" async defer></script>
    <style>
        :root { --primary: #0084ff; --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar { width: 320px; background: var(--card); border-right: 1px solid #ddd; padding: 25px; display: flex; flex-direction: column; gap: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.02); }
        .logo { font-size: 32px; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; text-decoration: none; }
        .logo span { color: #333; }

        .section-title { font-size: 0.75rem; font-weight: 700; color: #8d949e; text-transform: uppercase; margin-top: 10px; }
        
        .nav-item { padding: 12px 15px; border-radius: 10px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .nav-item:hover { background: #f2f3f5; }
        .nav-item.active { background: #e7f3ff; color: var(--primary); }

        /* –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ */
        .login-trigger { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; font-size: 1rem; }
        .login-trigger:hover { background: #0073e6; transform: translateY(-1px); }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 40px; border-radius: 24px; width: 340px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); animation: pop 0.3s ease; }
        @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main-content { flex-grow: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; align-items: center; }
        .feed { width: 100%; max-width: 600px; }

        /* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ */
        .create-post { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); }
        textarea { width: 100%; border: none; outline: none; font-size: 1.2rem; resize: none; font-family: inherit; margin-bottom: 10px; }
        .preview-img { width: 100%; border-radius: 12px; margin-top: 15px; display: none; border: 1px solid #eee; }
        
        .post-tools { display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 1px solid #f0f2f5; }
        .file-label { color: var(--primary); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .btn-send { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-send:disabled { background: #ccc; cursor: not-allowed; }

        /* –ü–æ—Å—Ç */
        .post { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #efefef; }
        .post-header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .user-pic { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .post-img { width: calc(100% + 40px); margin: 15px -20px; display: block; max-height: 500px; object-fit: cover; }
        .post-tag { font-size: 0.7rem; background: #f0f2f5; padding: 4px 10px; border-radius: 20px; margin-left: auto; color: #65676b; }
        
        /* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
        .comments-section { border-top: 1px solid #f0f2f5; margin-top: 15px; padding-top: 15px; }
        .comment { background: #f8f9fa; border-radius: 12px; padding: 10px; margin-bottom: 8px; font-size: 0.9rem; }
        .comment-author { font-weight: bold; color: var(--primary); font-size: 0.85rem; margin-bottom: 2px; }
        .comment-input-area { display: flex; gap: 10px; margin-top: 15px; }
        .comment-input { flex-grow: 1; border: 1px solid #ddd; border-radius: 20px; padding: 8px 15px; font-size: 0.9rem; outline: none; transition: 0.2s; }
        .comment-input:focus { border-color: var(--primary); }
        
        .action-btns { display: flex; gap: 15px; margin-top: 10px; }
        .like-btn { background: none; border: none; cursor: pointer; font-size: 1rem; color: #65676b; }
        .like-btn:hover { color: #e41e3f; }

        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <a href="#" class="logo">Fedo<span>form</span></a>
    
    <div id="authSection">
        <button class="login-trigger" onclick="openLogin()">–í–æ–π—Ç–∏ –≤ Fedoform</button>
    </div>

    <div class="section-title">–†–∞–∑–¥–µ–ª—ã</div>
    <div id="topicsList"></div>
    <button onclick="addTopic()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:600; padding:10px; text-align:left;">+ –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É</button>
</div>

<div class="main-content">
    <div class="feed">
        <div class="create-post" id="postBox">
            <textarea id="postText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å..." rows="2"></textarea>
            <img id="imgPreview" class="preview-img">
            <div class="post-tools">
                <label class="file-label">
                    üì∑ –§–æ—Ç–æ
                    <input type="file" id="fileInput" accept="image/*" onchange="previewFile()">
                </label>
                <button class="btn-send" id="sendBtn" onclick="sendPost()" disabled>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        <div id="wall"></div>
    </div>
</div>

<div id="loginModal" class="modal-overlay" onclick="closeLogin()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="logo" style="margin-bottom:15px; font-size:36px;">Fedo<span>form</span></div>
        <h2 style="margin-bottom:10px;">–í—Ö–æ–¥</h2>
        <p style="color: #666; margin-bottom: 30px;">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google, —á—Ç–æ–±—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∏ –æ—Ç–≤–µ—á–∞—Ç—å –¥—Ä—É–∑—å—è–º.</p>
        <div id="googleBtn" style="display: flex; justify-content: center;"></div>
        <button onclick="closeLogin()" style="margin-top:25px; background:none; border:none; color:#aaa; cursor:pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    // --- –î–ê–ù–ù–´–ï ---
    let topics = JSON.parse(localStorage.getItem('ff_topics')) || ['–û–±—â–µ–µ', '–ò–≥—Ä—ã', '–ö–æ–¥', '–ú–µ–º—ã'];
    let posts = JSON.parse(localStorage.getItem('ff_posts')) || [];
    let currentTopic = '–û–±—â–µ–µ';
    let currentUser = null; 
    let selectedImageData = "";

    // --- GOOGLE AUTH ---
    window.onload = function () {
        google.accounts.id.initialize({
            client_id: "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com", // <--- –í–°–¢–ê–í–¨ –°–í–û–ô ID –ó–î–ï–°–¨
            callback: handleCredentialResponse
        });
        init();
    };

    function handleCredentialResponse(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
        currentUser = { name: payload.name, avatar: payload.picture };
        
        document.getElementById("authSection").innerHTML = `
            <div style="display:flex; align-items:center; gap:10px; background:#f8f9fa; padding:10px; border-radius:12px;">
                <img src="${payload.picture}" class="user-pic" style="width:32px; height:32px;">
                <span style="font-weight:600; font-size:0.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${payload.name}</span>
                <button onclick="location.reload()" style="background:none; border:none; cursor:pointer; color:red; font-size:11px;">–í—ã—Ö–æ–¥</button>
            </div>
        `;
        document.getElementById("sendBtn").disabled = false;
        document.getElementById("postText").placeholder = `–ß—Ç–æ –Ω–æ–≤–æ–≥–æ, ${payload.given_name}?`;
        closeLogin();
        renderPosts(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–ª–∏—Å—å –ø–æ–ª—è –æ—Ç–≤–µ—Ç–æ–≤
    }

    function openLogin() {
        document.getElementById('loginModal').style.display = 'flex';
        google.accounts.id.renderButton(document.getElementById("googleBtn"), { theme: "outline", size: "large", width: 260 });
    }
    function closeLogin() { document.getElementById('loginModal').style.display = 'none'; }

    // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ---
    function init() {
        renderTopics();
        renderPosts();
    }

    function renderTopics() {
        const list = document.getElementById('topicsList');
        list.innerHTML = topics.map(t => `
            <div class="nav-item ${t === currentTopic ? 'active' : ''}" onclick="selectTopic('${t}')">
                # ${t}
            </div>
        `).join('');
    }

    function selectTopic(topic) {
        currentTopic = topic;
        renderTopics();
        renderPosts();
    }

    function addTopic() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã:");
        if (name && !topics.includes(name)) {
            topics.push(name);
            localStorage.setItem('ff_topics', JSON.stringify(topics));
            renderTopics();
        }
    }

    function previewFile() {
        const file = document.getElementById('fileInput').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            selectedImageData = reader.result;
            document.getElementById('imgPreview').src = reader.result;
            document.getElementById('imgPreview').style.display = 'block';
        };
        if (file) reader.readAsDataURL(file);
    }

    function sendPost() {
        const text = document.getElementById('postText').value.trim();
        if (!text && !selectedImageData) return;

        const post = {
            id: Date.now(),
            author: currentUser.name,
            avatar: currentUser.avatar,
            topic: currentTopic,
            content: text,
            image: selectedImageData,
            likes: 0,
            comments: []
        };

        posts.unshift(post);
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        
        document.getElementById('postText').value = '';
        document.getElementById('imgPreview').style.display = 'none';
        selectedImageData = "";
        renderPosts();
    }

    function renderPosts() {
        const wall = document.getElementById('wall');
        const filtered = posts.filter(p => p.topic === currentTopic);
        wall.innerHTML = filtered.length ? '' : '<div style="text-align:center; padding:40px; color:#888;">–í —ç—Ç–æ–π —Ç–µ–º–µ –ø–æ–∫–∞ –ø—É—Å—Ç–æ...</div>';
        
        filtered.forEach(p => {
            const commentsHtml = (p.comments || []).map(c => `
                <div class="comment">
                    <div class="comment-author">${c.author}</div>
                    <div>${c.text}</div>
                </div>
            `).join('');

            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
                <div class="post-header">
                    <img src="${p.avatar}" class="user-pic">
                    <span style="font-weight:700;">${p.author}</span>
                    <span class="post-tag">#${p.topic}</span>
                </div>
                <div style="font-size:1.1rem;">${p.content}</div>
                ${p.image ? `<img src="${p.image}" class="post-img">` : ''}
                
                <div class="action-btns">
                    <button class="like-btn" onclick="likePost(${p.id})">‚ù§Ô∏è ${p.likes}</button>
                    <button class="like-btn" onclick="deletePost(${p.id})">üóëÔ∏è</button>
                </div>

                <div class="comments-section">
                    <div id="comments-${p.id}">${commentsHtml}</div>
                    ${currentUser ? `
                        <div class="comment-input-area">
                            <input type="text" id="input-${p.id}" class="comment-input" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">
                            <button class="btn-send" style="padding:5px 15px; font-size:0.8rem;" onclick="addComment(${p.id})">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                        </div>
                    ` : ''}
                </div>
            `;
            wall.appendChild(div);
        });
    }

    function addComment(postId) {
        const input = document.getElementById(`input-${postId}`);
        const text = input.value.trim();
        if (!text) return;

        const post = posts.find(p => p.id === postId);
        if (!post.comments) post.comments = [];
        post.comments.push({ author: currentUser.name, text: text });

        localStorage.setItem('ff_posts', JSON.stringify(posts));
        renderPosts();
    }

    function likePost(id) {
        posts = posts.map(p => p.id === id ? {...p, likes: p.likes + 1} : p);
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        renderPosts();
    }

    function deletePost(id) {
        if (confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç –Ω–∞–≤—Å–µ–≥–¥–∞?")) {
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem('ff_posts', JSON.stringify(posts));
            renderPosts();
        }
    }
</script>
</body>
</html>


