<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fedoform ‚Äî –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Google -->
    <script src="https://accounts.google.com" async defer></script>
    <style>
        :root { --primary: #0084ff; --bg: #f2f4f7; --card: #ffffff; --text: #1c1e21; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; color: var(--text); }
        
        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar { width: 300px; background: var(--card); border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .logo { font-size: 28px; font-weight: 900; color: var(--primary); letter-spacing: -1px; margin-bottom: 10px; }
        .logo span { color: #333; }
        
        .section-title { font-size: 0.7rem; font-weight: bold; color: #8d949e; text-transform: uppercase; margin-top: 15px; }
        
        .nav-item { padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: #f0f2f5; }
        .nav-item.active { background: #e7f3ff; color: var(--primary); font-weight: bold; }

        /* –ü—Ä–æ—Ñ–∏–ª—å –∏ –≤—Ö–æ–¥ */
        #userProfile { background: #f8f9fa; padding: 10px; border-radius: 10px; display: none; align-items: center; gap: 10px; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –ª–µ–Ω—Ç–∞ */
        .main-content { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .feed { width: 100%; max-width: 580px; }
        
        /* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ */
        .create-post { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        textarea { width: 100%; border: none; outline: none; font-size: 1.1rem; resize: none; font-family: inherit; }
        .preview-img { width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid #ddd; }
        
        .post-tools { border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .upload-btn { color: var(--primary); cursor: pointer; font-weight: 600; font-size: 0.9rem; }
        .btn-send { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ—Å—Ç–∞ */
        .post { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; font-weight: bold; }
        .post-img { width: calc(100% + 40px); margin-left: -20px; margin-top: 10px; display: block; max-height: 400px; object-fit: cover; }
        .post-tag { font-size: 0.75rem; background: #e7f3ff; color: var(--primary); padding: 3px 8px; border-radius: 5px; margin-left: auto; }
        
        .like-btn { background: none; border: none; cursor: pointer; font-size: 1rem; margin-top: 10px; color: #65676b; transition: 0.2s; }
        .like-btn:hover { color: #e41e3f; transform: scale(1.1); }

        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo">Fedo<span>form</span></div>
    
    <div class="section-title">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>
    <div id="googleBtn"></div> <!-- –ö–Ω–æ–ø–∫–∞ Google -->
    
    <div id="userProfile">
        <img id="googleAvatar" class="user-avatar" src="">
        <span id="googleName" style="font-weight:600;"></span>
        <button onclick="logout()" style="margin-left:auto; background:none; border:none; cursor:pointer; font-size:12px; color:red;">–í—ã–π—Ç–∏</button>
    </div>

    <div class="section-title">–¢–µ–º—ã (–†–∞–∑–¥–µ–ª—ã)</div>
    <div id="topicsList"></div>
    <button onclick="addTopic()" style="background:none; border:none; color:var(--primary); cursor:pointer; text-align:left; padding:10px;">+ –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É</button>

    <div class="section-title">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä (–õ–æ–∫–∞–ª—å–Ω–æ)</div>
    <div id="localUsersList"></div>
</div>

<div class="main-content">
    <div class="feed">
        <div class="create-post">
            <textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ, " rows="2"></textarea>
            <img id="imgPreview" class="preview-img">
            <div class="post-tools">
                <label class="upload-btn">
                    üì∑ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                    <input type="file" id="fileInput" accept="image/*" onchange="previewFile()">
                </label>
                <button class="btn-send" onclick="sendPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        <div id="wall"></div>
    </div>
</div>

<script>
    // --- –î–ê–ù–ù–´–ï ---
    let users = JSON.parse(localStorage.getItem('ff_users')) || [{id: 1, name: '–ì–æ—Å—Ç—å', icon: 'üë§'}];
    let topics = JSON.parse(localStorage.getItem('ff_topics')) || ['–û–±—â–µ–µ', '–ò–≥—Ä—ã', '–ö–æ–¥'];
    let posts = JSON.parse(localStorage.getItem('ff_posts')) || [];
    
    let currentTopic = '–û–±—â–µ–µ';
    let currentUser = users[0];
    let selectedImageData = "";

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø GOOGLE ---
    window.onload = function () {
        google.accounts.id.initialize({
            client_id: "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com", // –ó–ê–ú–ï–ù–ò –ú–ï–ù–Ø
            callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(document.getElementById("googleBtn"), { theme: "outline", size: "large", width: 260 });
        init();
    };

    function handleCredentialResponse(response) {
        const payload = parseJwt(response.credential);
        currentUser = { id: payload.sub, name: payload.name, icon: 'üåê', avatar: payload.picture };
        
        document.getElementById("googleBtn").style.display = "none";
        document.getElementById("userProfile").style.display = "flex";
        document.getElementById("googleName").innerText = payload.name;
        document.getElementById("googleAvatar").src = payload.picture;
        document.getElementById("postText").placeholder = `–ß—Ç–æ –Ω–æ–≤–æ–≥–æ, ${payload.given_name}?`;
    }

    function parseJwt(token) {
        let base64Url = token.split('.')[1];
        let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(window.atob(base64));
    }

    function logout() { localStorage.clear(); location.reload(); }

    // --- –õ–û–ì–ò–ö–ê FEDOFORM ---
    function init() {
        renderTopics();
        renderLocalUsers();
        renderPosts();
    }

    function renderTopics() {
        const container = document.getElementById('topicsList');
        container.innerHTML = topics.map(t => `
            <div class="nav-item ${t === currentTopic ? 'active' : ''}" onclick="selectTopic('${t}')">
                # ${t}
            </div>
        `).join('');
    }

    function selectTopic(topic) {
        currentTopic = topic;
        renderTopics();
        renderPosts();
    }

    function addTopic() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã:");
        if (name && !topics.includes(name)) {
            topics.push(name);
            localStorage.setItem('ff_topics', JSON.stringify(topics));
            renderTopics();
        }
    }

    function previewFile() {
        const file = document.getElementById('fileInput').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            selectedImageData = reader.result;
            const preview = document.getElementById('imgPreview');
            preview.src = reader.result;
            preview.style.display = 'block';
        };
        if (file) reader.readAsDataURL(file);
    }

    function sendPost() {
        const text = document.getElementById('postText').value;
        if (!text && !selectedImageData) return;

        const post = {
            id: Date.now(),
            author: currentUser.name,
            avatar: currentUser.avatar || null,
            icon: currentUser.icon,
            topic: currentTopic,
            content: text,
            image: selectedImageData,
            likes: 0
        };

        posts.unshift(post);
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        
        document.getElementById('postText').value = '';
        document.getElementById('imgPreview').style.display = 'none';
        selectedImageData = "";
        renderPosts();
    }

    function renderPosts() {
        const wall = document.getElementById('wall');
        const filtered = posts.filter(p => p.topic === currentTopic);
        wall.innerHTML = filtered.length ? '' : '<p style="color:gray; margin-top:20px;">–¢—É—Ç –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤...</p>';
        
        filtered.forEach(p => {
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
                <div class="post-header">
                    ${p.avatar ? `<img src="${p.avatar}" class="user-avatar">` : `<div style="font-size:1.5rem">${p.icon}</div>`}
                    <span>${p.author}</span>
                    <span class="post-tag">${p.topic}</span>
                </div>
                <div>${p.content}</div>
                ${p.image ? `<img src="${p.image}" class="post-img">` : ''}
                <button class="like-btn" onclick="likePost(${p.id})">‚ù§Ô∏è ${p.likes}</button>
            `;
            wall.appendChild(div);
        });
    }

    function likePost(id) {
        posts = posts.map(p => p.id === id ? {...p, likes: p.likes + 1} : p);
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        renderPosts();
    }

    function renderLocalUsers() {
        const list = document.getElementById('localUsersList');
        list.innerHTML = users.map(u => `
            <div class="nav-item" onclick="changeLocalUser(${u.id})">${u.icon} ${u.name}</div>
        `).join('');
    }

    function changeLocalUser(id) {
        currentUser = users.find(u => u.id === id);
        alert(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞: ${currentUser.name}`);
    }
</script>
</body>
</html>


